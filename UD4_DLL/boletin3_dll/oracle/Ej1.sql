CREATE TABLE BARCOS(
	MATRICULA VARCHAR2(10),
	NOMBRE VARCHAR2(20),
	CLASE VARCHAR2(15),
	ARMADOR VARCHAR2(30),
	CAPACIDAD NUMBER(10),
	NACIONALIDAD VARCHAR2(25),
	CONSTRAINT PK_BARCOS PRIMARY KEY (MATRICULA)
);

CREATE TABLE CALADERO(
	CODIGO VARCHAR2(10),
	NOMBRE VARCHAR2(20),
	UBICACION VARCHAR2(25),
	ESPECIEPRINCIPAL VARCHAR2(10),
	CONSTRAINT PK_CALADERO PRIMARY KEY (CODIGO)
);

CREATE TABLE ESPECIE(
	CODIGO VARCHAR2(10),
	NOMBRE VARCHAR2(20),
	TIPO VARCHAR2(15),
	CUPOPORBARCO VARCHAR2(15),
	CALADEROPRINCIPAL VARCHAR2(15),
	CONSTRAINT PK_ESPECIE PRIMARY KEY(CODIGO),
	CONSTRAINT FK_ESPECIE FOREIGN KEY(CALADEROPRINCIPAL) REFERENCES CALADERO (CODIGO)
);

CREATE TABLE LOTES(
	CODIGO VARCHAR2(10),
	MATRICULA VARCHAR2(10),
	NUMKILOS NUMBER(15,2),
	PRECIOPORKILOSALIDA NUMBER(15),
	PRECIOPORKILOADJUDICADO NUMBER(15),
	FECHAVENTA DATE,
	CODESPECIE VARCHAR2(10),
	CONSTRAINT PK_LOTES PRIMARY KEY (CODIGO),
	CONSTRAINT FK1_LOTES FOREIGN KEY (MATRICULA) REFERENCES BARCOS (MATRICULA),
	CONSTRAINT FK2_LOTES FOREIGN KEY (CODESPECIE) REFERENCES ESPECIE (CODIGO)
);

CREATE TABLE FECHACAPTURASPERMITIDAS(
	CODESPECIE VARCHAR2(10),
	CODCALADERO VARCHAR2(10),
	FECHAINICIAL DATE,
	FECHAFINAL DATE,
	CONSTRAINT PK_FECHACP PRIMARY KEY(CODESPECIE, CODCALADERO),
	CONSTRAINT FK1_FECHACP FOREIGN KEY(CODESPECIE) REFERENCES ESPECIE (CODIGO),
	CONSTRAINT FK2_FECHACP FOREIGN KEY(CODCALADERO) REFERENCES CALADERO (CODIGO)
);

ALTER TABLE CALADERO ADD CONSTRAINT FK1_CALADERO FOREIGN KEY (ESPECIEPRINCIPAL) REFERENCES ESPECIE(CODIGO);

--TABLA BARCOS
ALTER TABLE BARCOS ADD CONSTRAINT CHK1_MATRICULA CHECK (REGEXP_LIKE(MATRICULA, '^[A-Z]{2}-[0-9]{4}$'));
ALTER TABLE BARCOS DROP COLUMN ARMADOR;


--TABLA CALADERO--
ALTER TABLE CALADERO ADD NOMBRECIENTIFICO VARCHAR2(50);
ALTER TABLE CALADERO ADD CONSTRAINT CHK1_CALADERO CHECK (NOMBRE = UPPER(NOMBRE));
ALTER TABLE CALADERO ADD CONSTRAINT CHK2_CALADERO CHECK (UBICACION = UPPER(UBICACION));

--TABLA LOTES--
ALTER TABLE LOTES MODIFY (FECHAVENTA NOT NULL);
ALTER TABLE LOTES ADD CONSTRAINT CHK1_LOTES CHECK (PRECIOPORKILOADJUDICADO > PRECIOPORKILOSALIDA);
ALTER TABLE LOTES ADD CONSTRAINT CHK2_LOTES CHECK (NUMKILOS > 0 AND PRECIOPORKILOSALIDA > 0 AND PRECIOPORKILOADJUDICADO > 0);

--TABLA FECHACAPTURASPERMITIDAS--
ALTER TABLE FECHACAPTURASPERMITIDAS ADD CONSTRAINT CHK1_FECHACP CHECK (TO_DATE(TO_CHAR(FECHAFINAL, 'MMDD') || '2000', 'MMDDYYYY') < TO_DATE('02-02-2000', 'DD-MM-YYYY') OR TO_DATE(TO_CHAR(FECHAINICIAL, 'MMDD') || '2000', 'MMDDYYYY') > TO_DATE('28-03-2000', 'DD-MM-YYYY'));


INSERT INTO BARCOS (MATRICULA, NOMBRE, CLASE, CAPACIDAD, NACIONALIDAD) VALUES ('ES-1234', 'EL PEREGIL', 'ARRASTRE', 50000, 'FRANCESA');
INSERT INTO BARCOS (MATRICULA, NOMBRE, CLASE, CAPACIDAD, NACIONALIDAD) VALUES ('PT-5678', 'ARA SINTENDO', 'CERCO', 35000, 'PORTUGUESA');

INSERT INTO CALADERO (CODIGO, NOMBRE, UBICACION, ESPECIEPRINCIPAL, NOMBRECIENTIFICO) VALUES ('CA001', 'BIRIS NORTE', 'COSTA DE ITALICA', NULL, 'PALANCANA MORTUS');
INSERT INTO CALADERO (CODIGO, NOMBRE, UBICACION, ESPECIEPRINCIPAL, NOMBRECIENTIFICO) VALUES ('CA002', 'CAÃ‘AMERO', 'MAR DE BUSTAMANTE', NULL, 'SAN JOSELUS');

INSERT INTO ESPECIE (CODIGO, NOMBRE, TIPO, CUPOPORBARCO, CALADEROPRINCIPAL) VALUES ('ATUNR', 'ATUN ROJO', 'PELAGICA', '5000KG', 'CA001');
INSERT INTO ESPECIE (CODIGO, NOMBRE, TIPO, CUPOPORBARCO, CALADEROPRINCIPAL) VALUES ('MEZQU', 'MEZQUITILLA', 'DEMERSAL', '2000KG', 'CA002');

INSERT INTO LOTES (CODIGO, MATRICULA, NUMKILOS, PRECIOPORKILOSALIDA, PRECIOPORKILOADJUDICADO, FECHAVENTA, CODESPECIE) VALUES ('LOTE01', 'ES-1234', 950, 10, 45, TO_DATE('2025-11-25', 'YYYY-MM-DD'), 'ATUNR');
INSERT INTO LOTES (CODIGO, MATRICULA, NUMKILOS, PRECIOPORKILOSALIDA, PRECIOPORKILOADJUDICADO, FECHAVENTA, CODESPECIE) VALUES ('LOTE02', 'PT-5678', 450, 5, 25, TO_DATE('2025-11-26', 'YYYY-MM-DD'), 'MEZQU');

INSERT INTO FECHACAPTURASPERMITIDAS (CODESPECIE, CODCALADERO, FECHAINICIAL, FECHAFINAL) VALUES ('ATUNR', 'CA001', TO_DATE('2025-04-01', 'YYYY-MM-DD'), TO_DATE('2025-09-30', 'YYYY-MM-DD'));
INSERT INTO FECHACAPTURASPERMITIDAS (CODESPECIE, CODCALADERO, FECHAINICIAL, FECHAFINAL) VALUES ('MEZQU', 'CA002', TO_DATE('2025-11-01', 'YYYY-MM-DD'), TO_DATE('2026-01-31', 'YYYY-MM-DD'));

--BORRAR TODAS LA TABLAS--
/*
DROP TABLE FECHACAPTURASPERMITIDAS;
DROP TABLE LOTES;
DROP TABLE CALADERO CASCADE CONSTRAINTS;
DROP TABLE ESPECIE CASCADE CONSTRAINTS;
DROP TABLE BARCOS CASCADE CONSTRAINTS;
*/